# Система управления пользователями и ролями
## Система безопасности инфраструктуры ТюмГУ

---

## Содержание

1. [Обзор системы ролей](#обзор-системы-ролей)
2. [Типы ролей и их права](#типы-ролей-и-их-права)
3. [Управление пользователями](#управление-пользователями)
4. [Типы авторизации](#типы-авторизации)
5. [Безопасность](#безопасность)
6. [Примеры использования](#примеры-использования)

---

## Обзор системы ролей

Система безопасности инфраструктуры ТюмГУ использует ролевую модель доступа (RBAC - Role-Based Access Control) для управления правами пользователей. Каждому пользователю назначается роль, которая определяет, к каким разделам и функциям системы он имеет доступ.

### Принципы работы

- **Роль определяет права доступа** - каждая роль имеет предопределенный набор разрешений
- **Один пользователь - одна роль** - пользователь может иметь только одну роль одновременно
- **Динамическая фильтрация меню** - пользователь видит только те разделы, к которым у него есть доступ
- **Прозрачность прав** - система четко показывает, какие права есть у каждой роли

---

## Типы ролей и их права

### 1. Администратор (admin)

**Описание:** Полный доступ ко всем функциям системы

**Доступные разделы:**
- ✅ Главная панель
- ✅ Отчет о проходах
- ✅ Местонахождение людей
- ✅ Аналитика
- ✅ Парковочная система
- ✅ Система хранения вещей
- ✅ Отчет по иностранным студентам
- ✅ Отчет по студентам
- ✅ Отчет по сотрудникам
- ✅ **Управление пользователями** (только для администраторов)

**Дополнительные права:**
- Создание, редактирование и удаление пользователей
- Изменение ролей пользователей
- Доступ к настройкам системы
- Экспорт данных
- Просмотр всех отчетов

**Кому назначать:**
- Руководители отдела безопасности
- Системные администраторы
- IT-администраторы

---

### 2. Безопасность (security)

**Описание:** Доступ к системам безопасности и контроля доступа

**Доступные разделы:**
- ✅ Главная панель
- ✅ Отчет о проходах
- ✅ Местонахождение людей
- ✅ Парковочная система
- ✅ Система хранения вещей

**Ограничения:**
- ❌ Нет доступа к аналитике
- ❌ Нет доступа к отчетам по студентам/сотрудникам
- ❌ Нет доступа к управлению пользователями

**Кому назначать:**
- Сотрудники службы безопасности
- Охранники
- Операторы систем контроля доступа

---

### 3. Менеджер (manager)

**Описание:** Доступ к аналитике и отчетам

**Доступные разделы:**
- ✅ Главная панель
- ✅ Аналитика
- ✅ Отчет по студентам
- ✅ Отчет по сотрудникам
- ✅ Отчет по иностранным студентам

**Ограничения:**
- ❌ Нет доступа к системам безопасности (проходы, местонахождение)
- ❌ Нет доступа к парковке и хранению вещей
- ❌ Нет доступа к управлению пользователями

**Кому назначать:**
- Руководители подразделений
- Менеджеры по работе со студентами
- Сотрудники деканатов

---

### 4. Оператор (operator)

**Описание:** Доступ к просмотру и работе с данными

**Доступные разделы:**
- ✅ Главная панель
- ✅ Отчет о проходах
- ✅ Местонахождение людей
- ✅ Отчет по студентам
- ✅ Отчет по сотрудникам

**Ограничения:**
- ❌ Нет доступа к аналитике
- ❌ Нет доступа к парковке и хранению вещей
- ❌ Нет доступа к отчетам по иностранным студентам
- ❌ Нет доступа к управлению пользователями

**Кому назначать:**
- Операторы колл-центра
- Сотрудники справочной службы
- Технические специалисты

---

### 5. Наблюдатель (viewer)

**Описание:** Минимальный доступ - только просмотр общей информации

**Доступные разделы:**
- ✅ Главная панель
- ✅ Аналитика (только просмотр)

**Ограничения:**
- ❌ Нет доступа к детальным отчетам
- ❌ Нет доступа к персональным данным
- ❌ Нет доступа к системам безопасности
- ❌ Нет возможности экспорта данных
- ❌ Нет доступа к управлению пользователями

**Кому назначать:**
- Внешние аудиторы (на время проверки)
- Временные сотрудники
- Студенты-практиканты
- Руководство (для ознакомления с общей статистикой)

---

## Управление пользователями

### Создание нового пользователя

1. Откройте раздел **"Управление пользователями"** (доступен только администраторам)
2. Нажмите кнопку **"Добавить"**
3. Заполните обязательные поля:
   - **Логин** - уникальное имя пользователя или email
   - **ФИО** - полное имя пользователя
   - **Email** - адрес электронной почты
   - **Тип авторизации** - Локальная или SSO UTMN
   - **Пароль** - только для локальной авторизации
   - **Роль** - выберите подходящую роль
4. Установите статус **"Активный пользователь"**
5. Нажмите **"Сохранить"**

### Редактирование пользователя

1. Найдите пользователя в списке
2. Нажмите кнопку **"Редактировать"** (иконка карандаша)
3. Внесите необходимые изменения
4. Нажмите **"Сохранить"**

**Важно:** При изменении роли пользователя, его права доступа обновятся немедленно.

### Деактивация пользователя

Вместо удаления пользователя рекомендуется его деактивация:

1. Найдите пользователя в списке
2. Переключите переключатель в колонке **"Статус"**
3. Деактивированный пользователь не сможет войти в систему

### Удаление пользователя

**Осторожно:** Удаление пользователя необратимо!

1. Найдите пользователя в списке
2. Нажмите кнопку **"Удалить"** (иконка корзины)
3. Подтвердите удаление

---

## Типы авторизации

### Локальная авторизация

**Описание:** Пользователь авторизуется с использованием логина и пароля, хранящихся в базе данных системы.

**Преимущества:**
- Полный контроль над учетными записями
- Независимость от внешних систем
- Возможность быстрого создания временных учетных записей

**Недостатки:**
- Необходимость управления паролями
- Нет единой точки входа с другими системами ТюмГУ

**Рекомендуется для:**
- Внешних подрядчиков
- Временных сотрудников
- Тестовых учетных записей
- Служебных аккаунтов

**Требования к паролю:**
- Минимум 8 символов
- Должен содержать буквы и цифры
- Рекомендуется использовать специальные символы

---

### SSO UTMN (Single Sign-On)

**Описание:** Пользователь авторизуется через единую систему аутентификации ТюмГУ, используя свою учетную запись университета.

**Преимущества:**
- Единая точка входа для всех систем ТюмГУ
- Нет необходимости запоминать отдельный пароль
- Централизованное управление доступом
- Автоматическая синхронизация данных пользователя

**Недостатки:**
- Зависимость от доступности SSO сервиса
- Требуется действующая учетная запись в системе ТюмГУ

**Рекомендуется для:**
- Всех сотрудников ТюмГУ
- Студентов университета
- Постоянных пользователей системы

**Процесс авторизации:**
1. Пользователь нажимает кнопку **"Войти через SSO UTMN"**
2. Перенаправление на страницу авторизации ТюмГУ
3. Ввод логина и пароля корпоративной учетной записи
4. Автоматический возврат в систему безопасности

---

## Безопасность

### Политика паролей (для локальных учетных записей)

- **Минимальная длина:** 8 символов
- **Сложность:** Рекомендуется использовать комбинацию букв, цифр и специальных символов
- **Срок действия:** 90 дней (рекомендуется)
- **История паролей:** Нельзя использовать 5 последних паролей
- **Блокировка:** После 5 неудачных попыток входа

### Логирование действий

Все действия пользователей логируются:
- Вход в систему
- Выход из системы
- Просмотр отчетов
- Экспорт данных
- Изменение настроек пользователей

### Сессии

- **Время жизни сессии:** 8 часов активности
- **Автоматический выход:** После 30 минут неактивности
- **Принудительный выход:** При изменении роли или деактивации учетной записи

---

## Примеры использования

### Пример 1: Настройка доступа для сотрудника безопасности

**Задача:** Новый охранник должен иметь доступ к системе контроля проходов

**Решение:**
1. Создайте нового пользователя
2. Логин: `ivanov_security`
3. ФИО: Иванов Петр Сергеевич
4. Email: `ivanov.security@utmn.ru`
5. Тип авторизации: **Локальная** (если нет корпоративной учетной записи)
6. Пароль: Создайте надежный пароль
7. Роль: **Безопасность**
8. Статус: Активный

**Результат:** Пользователь получит доступ к:
- Отчетам о проходах
- Системе определения местонахождения
- Парковочной системе
- Системе хранения вещей

---

### Пример 2: Настройка доступа для руководителя подразделения

**Задача:** Декан факультета хочет видеть статистику по студентам

**Решение:**
1. Создайте нового пользователя
2. Логин: `petrova@utmn.ru`
3. ФИО: Петрова Мария Ивановна
4. Email: `petrova@utmn.ru`
5. Тип авторизации: **SSO UTMN** (использует корпоративную учетную запись)
6. Роль: **Менеджер**
7. Статус: Активный

**Результат:** Пользователь получит доступ к:
- Аналитике
- Отчетам по студентам
- Отчетам по сотрудникам
- Отчетам по иностранным студентам

**НЕ получит доступ к:**
- Системам контроля доступа
- Парковочной системе
- Управлению пользователями

---

### Пример 3: Временный доступ для аудитора

**Задача:** Внешний аудитор на 1 неделю должен видеть общую статистику

**Решение:**
1. Создайте нового пользователя
2. Логин: `auditor_temp`
3. ФИО: Сидоров Алексей Николаевич
4. Email: `sidorov@audit-company.ru`
5. Тип авторизации: **Локальная**
6. Пароль: Создайте временный пароль и передайте аудитору
7. Роль: **Наблюдатель**
8. Статус: Активный

**Результат:** Пользователь получит доступ только к:
- Главной панели с общей статистикой
- Аналитике (только просмотр)

**После завершения аудита:**
- Деактивируйте или удалите учетную запись

---

### Пример 4: Изменение роли при повышении

**Ситуация:** Сотрудник службы безопасности был назначен руководителем отдела

**Действия:**
1. Откройте список пользователей
2. Найдите сотрудника (например, Иванов И.И.)
3. Нажмите кнопку **"Редактировать"**
4. Измените роль с **"Безопасность"** на **"Администратор"**
5. Сохраните изменения

**Результат:** 
- Пользователь получит полный доступ ко всем разделам системы
- Появится раздел "Управление пользователями"
- Изменения вступят в силу немедленно

---

## Матрица доступа

| Раздел системы | Admin | Security | Manager | Operator | Viewer |
|----------------|-------|----------|---------|----------|--------|
| Главная панель | ✅ | ✅ | ✅ | ✅ | ✅ |
| Отчет о проходах | ✅ | ✅ | ❌ | ✅ | ❌ |
| Местонахождение людей | ✅ | ✅ | ❌ | ✅ | ❌ |
| Аналитика | ✅ | ❌ | ✅ | ❌ | ✅ |
| Парковочная система | ✅ | ✅ | ❌ | ❌ | ❌ |
| Система хранения вещей | ✅ | ✅ | ❌ | ❌ | ❌ |
| Иностранные студенты | ✅ | ❌ | ✅ | ❌ | ❌ |
| Отчет по студентам | ✅ | ❌ | ✅ | ✅ | ❌ |
| Отчет по сотрудникам | ✅ | ❌ | ✅ | ✅ | ❌ |
| **Управление пользователями** | ✅ | ❌ | ❌ | ❌ | ❌ |

---

## Рекомендации

### Для администраторов системы

1. **Принцип минимальных привилегий** - назначайте пользователям только те права, которые им необходимы для работы
2. **Регулярный аудит** - проверяйте список активных пользователей раз в месяц
3. **Деактивация вместо удаления** - деактивируйте учетные записи уволенных сотрудников вместо удаления для сохранения истории
4. **Используйте SSO** - по возможности используйте SSO UTMN вместо локальных учетных записей
5. **Документируйте изменения** - ведите журнал изменений ролей и прав доступа

### Для пользователей

1. **Безопасность паролей** - не используйте простые пароли типа "123456" или "password"
2. **Не передавайте учетные данные** - каждому сотруднику должна быть создана отдельная учетная запись
3. **Выходите из системы** - всегда выходите из системы при завершении работы
4. **Сообщайте о проблемах** - если вам недоступен нужный раздел, обратитесь к администратору

---

## Техническая реализация

### Структура контекста авторизации

```typescript
// Определение ролей
export type UserRole = 'admin' | 'security' | 'manager' | 'operator' | 'viewer';

// Права доступа для каждой роли
export const ROLE_PERMISSIONS: Record<UserRole, string[]> = {
  admin: ['dashboard', 'passes', 'location', 'analytics', 'parking', 
          'storage', 'foreign-students', 'students', 'employees', 'users-settings'],
  security: ['dashboard', 'passes', 'location', 'parking', 'storage'],
  manager: ['dashboard', 'analytics', 'students', 'employees', 'foreign-students'],
  operator: ['dashboard', 'passes', 'location', 'students', 'employees'],
  viewer: ['dashboard', 'analytics'],
};
```

### Проверка прав доступа

```typescript
// Проверка одного права
const canViewPasses = hasPermission('passes');

// Проверка нескольких прав (хотя бы одно)
const canViewReports = hasAnyPermission(['students', 'employees']);

// Использование в компонентах
{hasPermission('users-settings') && <UsersSettingsPage />}
```

---

## FAQ

**Q: Можно ли назначить пользователю несколько ролей?**  
A: Нет, в текущей версии системы каждый пользователь может иметь только одну роль.

**Q: Как дать временный доступ к системе?**  
A: Создайте учетную запись с ролью "Наблюдатель" и деактивируйте её после истечения срока.

**Q: Что делать, если пользователь забыл пароль?**  
A: Администратор может установить новый пароль в разделе редактирования пользователя.

**Q: Можно ли создать кастомную роль?**  
A: В текущей версии нет, но планируется в будущих обновлениях.

**Q: Логируются ли действия пользователей?**  
A: Да, все действия записываются в журнал аудита (требуется настройка на backend).

---

## Поддержка

При возникновении вопросов по управлению пользователями и ролями обращайтесь:

**Email:** security-support@utmn.ru  
**Телефон:** +7 (3452) XX-XX-XX  
**Внутренний номер:** XXXX

---

© 2026 Тюменский государственный университет. Все права защищены.
