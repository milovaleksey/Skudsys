# 📊 Схема установки системы

## 🎯 Общий план установки

```
┌─────────────────────────────────────────────────────────────┐
│                    УСТАНОВКА СИСТЕМЫ                         │
│                 Система безопасности ТюмГУ                   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 1: Установка зависимостей                              │
│  ├─ Node.js 18+ и npm                                       │
│  ├─ MySQL 8.0+                                              │
│  └─ Git (опционально)                                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 2: Загрузка проекта                                    │
│  ├─ Git clone или ZIP                                       │
│  └─ Распаковка в папку                                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 3: Настройка MySQL                                     │
│  ├─ CREATE DATABASE utmn_security                           │
│  ├─ CREATE USER (опционально)                               │
│  └─ GRANT PRIVILEGES                                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 4: Настройка Backend                                   │
│  ├─ cd backend                                              │
│  ├─ npm install                                             │
│  ├─ cp .env.example .env                                    │
│  ├─ Редактировать .env (DB_PASSWORD)                        │
│  └─ node src/scripts/initDatabase.js                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 5: Настройка Frontend                                  │
│  ├─ cd ..                                                   │
│  └─ npm install                                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 6: Запуск                                              │
│  ├─ ./start.sh (Linux/Mac)                                 │
│  ├─ start.bat (Windows)                                    │
│  │   или вручную:                                           │
│  ├─ Terminal 1: cd backend && npm run dev                   │
│  └─ Terminal 2: npm run dev                                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  ✅ ГОТОВО!                                                 │
│  Frontend: http://localhost:5173                            │
│  Backend:  http://localhost:3000                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 🏗️ Архитектура системы

```
┌──────────────────────────────────────────────────────────────┐
│                        БРАУЗЕР                                │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  React Frontend (http://localhost:5173)                │  │
│  │  - Страницы входа                                      │  │
│  │  - Дашборд                                             │  │
│  │  - Управление пользователями                           │  │
│  │  - Аналитика                                           │  │
│  └────────────────────┬───────────────────────────────────┘  │
└───────────────────────┼──────────────────────────────────────┘
                        │
                        │ HTTP Requests
                        │ (fetch API)
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│              Backend API (http://localhost:3000)            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Express.js Server                                    │  │
│  │  ├─ /v1/auth     - Авторизация                       │  │
│  │  ├─ /v1/users    - Пользователи                      │  │
│  │  ├─ /v1/students - Студенты                          │  │
│  │  ├─ /v1/employees - Сотрудники                       │  │
│  │  ├─ /v1/analytics - Аналитика                        │  │
│  │  └─ /v1/...      - Другие endpoints                  │  │
│  └──────────────────────┬───────────────────────────────┘  │
└─────────────────────────┼──────────────────────────────────┘
                          │
                          │ SQL Queries
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│              MySQL Database (localhost:3306)                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  utmn_security                                        │  │
│  │  ├─ users            (5 записей)                     │  │
│  │  ├─ roles            (5 ролей)                       │  │
│  │  ├─ students         (100 записей)                   │  │
│  │  ├─ employees        (50 записей)                    │  │
│  │  ├─ access_logs      (500 записей)                   │  │
│  │  └─ ... (всего 11 таблиц)                           │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 📁 Структура проекта после установки

```
utmn-security/
│
├── 📂 backend/                      # Backend приложение
│   ├── 📂 node_modules/             # ✅ Зависимости (после npm install)
│   ├── 📂 src/
│   │   ├── 📂 config/
│   │   │   └── database.js          # Подключение к MySQL
│   │   ├── 📂 controllers/          # Контроллеры API
│   │   ├── 📂 middleware/           # Middleware (auth, errors)
│   │   ├── 📂 models/               # Модели данных
│   │   ├── 📂 routes/               # Маршруты API
│   │   ├── 📂 scripts/
│   │   │   └── initDatabase.js     # Инициализация БД
│   │   ├── 📂 utils/
│   │   └── server.js               # Главный файл сервера
│   ├── 📂 database/
│   │   ├── schema.sql              # SQL схема
│   │   └── seed.sql                # Тестовые данные
│   ├── .env                        # ✅ Настройки (создать из .env.example)
│   ├── .env.example                # Шаблон настроек
│   ├── package.json
│   └── package-lock.json
│
├── 📂 src/                          # Frontend приложение
│   ├── 📂 components/               # React компоненты
│   ├── 📂 pages/                    # Страницы
│   ├── 📂 context/                  # React Context (Auth)
│   ├── 📂 hooks/                    # Custom hooks
│   ├── 📂 utils/                    # Утилиты
│   ├── 📂 styles/                   # CSS стили
│   ├── App.tsx                      # Главный компонент
│   └── main.tsx                     # Entry point
│
├── 📂 node_modules/                 # ✅ Зависимости (после npm install)
├── 📂 public/                       # Публичные файлы
│   ├── logo.svg                     # Логотип ТюмГУ
│   └── ...
│
├── 📄 package.json                  # Frontend зависимости
├── 📄 package-lock.json
├── 📄 vite.config.ts                # Vite конфигурация
├── 📄 tsconfig.json                 # TypeScript конфигурация
│
├── 📄 start.sh                      # Запуск (Linux/Mac)
├── 📄 start.bat                     # Запуск (Windows)
│
└── 📄 Документация:
    ├── INSTALLATION_GUIDE.md        # ⭐ Полная инструкция
    ├── QUICK_INSTALL.md             # Быстрая установка
    ├── COMMANDS_CHEATSHEET.md       # Шпаргалка команд
    ├── SETUP_DIAGRAM.md             # Эта схема
    └── ...
```

---

## 🔄 Поток данных при входе

```
┌─────────────┐
│  Пользователь│
│  вводит      │
│  логин/пароль│
└──────┬───────┘
       │
       ▼
┌─────────────────────────────────────┐
│  Frontend (LoginPage)                │
│  1. Валидация формы                  │
│  2. Отправка POST /v1/auth/login     │
└──────┬───────────────────────────────┘
       │
       │ HTTP POST
       │ {username, password}
       │
       ▼
┌─────────────────────────────────────┐
│  Backend (authController)            │
│  1. Получение данных                 │
│  2. Валидация пароля                 │
│  3. Проверка в БД                    │
└──────┬───────────────────────────────┘
       │
       │ SQL Query
       │ SELECT * FROM users WHERE username=?
       │
       ▼
┌─────────────────────────────────────┐
│  MySQL (users table)                 │
│  1. Поиск пользователя               │
│  2. Возврат данных                   │
└──────┬───────────────────────────────┘
       │
       │ User data
       │
       ▼
┌─────────────────────────────────────┐
│  Backend                             │
│  1. Сравнение паролей (bcrypt)       │
│  2. Генерация JWT токена             │
│  3. Возврат токена + данные          │
└──────┬───────────────────────────────┘
       │
       │ Response
       │ {token, user: {...}}
       │
       ▼
┌─────────────────────────────────────┐
│  Frontend                            │
│  1. Сохранение токена (localStorage) │
│  2. Обновление AuthContext           │
│  3. Редирект на Dashboard            │
└─────────────────────────────────────┘
```

---

## 🔐 Структура базы данных (11 таблиц)

```
utmn_security
│
├── 👤 users                     # Пользователи системы
│   ├── user_id (PK)
│   ├── username
│   ├── password_hash
│   ├── full_name
│   ├── email
│   ├── role
│   └── ...
│
├── 🎭 roles                     # Роли
│   ├── role_id (PK)
│   ├── role_name
│   └── description
│
├── 🔑 role_permissions          # Права ролей
│   ├── role_perm_id (PK)
│   ├── role_id (FK)
│   └── permission_id (FK)
│
├── 📋 permission_types          # Типы прав
│   ├── permission_id (PK)
│   └── permission_name
│
├── 🎓 students                  # Студенты
│   ├── student_id (PK)
│   ├── full_name
│   ├── student_card_number
│   ├── faculty
│   └── ...
│
├── 👔 employees                 # Сотрудники
│   ├── employee_id (PK)
│   ├── full_name
│   ├── position
│   ├── department
│   └── ...
│
├── 🌍 foreign_students          # Иностранные студенты
│   ├── foreign_student_id (PK)
│   ├── student_id (FK)
│   ├── country
│   └── visa_expiry_date
│
├── 🚪 access_logs               # Логи доступа
│   ├── log_id (PK)
│   ├── person_type
│   ├── person_id
│   ├── location
│   └── timestamp
│
├── 🚗 parking                   # Парковка
│   ├── parking_id (PK)
│   ├── vehicle_number
│   ├── owner_type
│   └── ...
│
├── 📦 storage                   # Хранение вещей
│   ├── storage_id (PK)
│   ├── item_description
│   ├── owner_id
│   └── ...
│
└── 🏠 dormitories               # Общежития
    ├── dormitory_id (PK)
    ├── name
    ├── address
    └── capacity
```

---

## ⏱️ Время установки

```
┌──────────────────────────────────────────┐
│  Этап                 │  Время           │
├──────────────────────────────────────────┤
│  Node.js              │  3-5 минут       │
│  MySQL                │  5-10 минут      │
│  Загрузка проекта     │  1 минута        │
│  БД создание          │  1 минута        │
│  Backend npm install  │  2-5 минут       │
│  Frontend npm install │  2-5 минут       │
│  Инициализация БД     │  10-30 секунд    │
│  Запуск               │  10 секунд       │
├──────────────────────────────────────────┤
│  ИТОГО                │  15-30 минут     │
└──────────────────────────────────────────┘

* При наличии быстрого интернета
* При установке на чистую систему
```

---

## 🎯 Чеклист готовности

```
✅ = Готово
⬜ = Нужно выполнить

ЗАВИСИМОСТИ:
⬜ Node.js 18+ установлен
⬜ npm работает
⬜ MySQL 8.0+ установлен
⬜ MySQL запущен

ПРОЕКТ:
⬜ Проект скачан/клонирован
⬜ Открыт в терминале

БАЗА ДАННЫХ:
⬜ БД utmn_security создана
⬜ Таблицы созданы (11 шт)
⬜ Тестовые данные загружены
⬜ Можно войти в MySQL

BACKEND:
⬜ Зависимости установлены (node_modules/)
⬜ Файл .env создан
⬜ Пароль MySQL указан в .env
⬜ Подключение к БД работает

FRONTEND:
⬜ Зависимости установлены (node_modules/)

ЗАПУСК:
⬜ Backend запущен (порт 3000)
⬜ Frontend запущен (порт 5173)
⬜ http://localhost:5173 открывается
⬜ Можно войти как admin_security

ГОТОВО! 🎉
```

---

## 🚀 Команды для копирования

### Полная установка одной командой (Linux/Mac):

```bash
# Создать БД
mysql -u root -p << EOF
CREATE DATABASE utmn_security CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
EOF

# Установить зависимости и настроить
cd backend && npm install && cp .env.example .env && cd .. && npm install

# После настройки .env:
cd backend && node src/scripts/initDatabase.js && cd ..

# Запустить
./start.sh
```

### Полная установка (Windows):

```cmd
REM Создать БД через MySQL Workbench или консоль

REM Установить зависимости
cd backend
npm install
copy .env.example .env

REM Отредактировать backend\.env (указать DB_PASSWORD)

REM Инициализировать БД
node src\scripts\initDatabase.js
cd ..

REM Установить frontend
npm install

REM Запустить
start.bat
```

---

## 📞 Помощь

Если что-то не работает:

1. ✅ Проверьте чеклист выше
2. 📖 Прочитайте [INSTALLATION_GUIDE.md](INSTALLATION_GUIDE.md)
3. 📋 Посмотрите [COMMANDS_CHEATSHEET.md](COMMANDS_CHEATSHEET.md)
4. 🐛 Проверьте раздел "Решение проблем"

---

**Версия:** 1.0  
**Дата:** 20.01.2026  
**ТюмГУ - Системы безопасности инфраструктуры**
