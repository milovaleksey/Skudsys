# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–¢–æ–∫–µ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage, –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞:
```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω"
  }
}
```

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ TokenManager

**–§–∞–π–ª—ã:**
- `/lib/api.ts`
- `/frontend/lib/api.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
static setToken(token: string): void {
  console.log('üíæ Saving token:', token ? `${token.substring(0, 20)}...` : 'null');
  localStorage.setItem(this.TOKEN_KEY, token);
  console.log('‚úÖ Token saved to localStorage');
}

static getToken(): string | null {
  const token = localStorage.getItem(this.TOKEN_KEY);
  console.log('üîë Getting token:', token ? `${token.substring(0, 20)}...` : 'null');
  return token;
}
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ AuthContext

**–§–∞–π–ª—ã:**
- `/contexts/AuthContext.tsx`
- `/frontend/contexts/AuthContext.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ frontend

```bash
# –ï—Å–ª–∏ –µ—â–µ –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏
./copy-all-now.sh
```

### 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å frontend

```bash
cd frontend
npm run build
```

### 3. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å

```bash
cd ..
sudo ./deploy-production.sh
```

–∏–ª–∏

```bash
sudo ./quick-deploy.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Console**
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —Å –ª–æ–≥–∏–Ω–æ–º `admin` –∏ –ø–∞—Ä–æ–ª–µ–º `Admin2025`

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏:**

```
üîê Attempting login for: admin authType: local
üì• Login response: {success: true, data: {...}}
‚úÖ Login successful, saving tokens...
Token: eyJhbGciOiJIUzI1NiI...
Refresh Token: present
üíæ Saving token: eyJhbGciOiJIUzI1NiI...
‚úÖ Token saved to localStorage
üíæ Saving refresh token
üë§ Setting user: {id: 1, username: 'admin', ...}
üîë Getting token: eyJhbGciOiJIUzI1NiI...
‚úîÔ∏è Token verification after save: saved
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage

–í DevTools:
1. –í–∫–ª–∞–¥–∫–∞ **Application** (–∏–ª–∏ **Storage** –≤ Firefox)
2. –†–∞–∑–¥–µ–ª **Local Storage**
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω
4. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–ª—é—á–∏:
   - `auth_token` - JWT —Ç–æ–∫–µ–Ω
   - `refresh_token` - Refresh —Ç–æ–∫–µ–Ω

### 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

1. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"
2. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:

```
üîë Getting token: eyJhbGciOiJIUzI1NiI...
```

3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è **–±–µ–∑ –æ—à–∏–±–∫–∏ UNAUTHORIZED**

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–í –∫–æ–Ω—Å–æ–ª–∏:**
```
üíæ Saving token: eyJhbGciOiJIUzI1NiI...
‚úÖ Token saved to localStorage
üîë Getting token: null  ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
‚úîÔ∏è Token verification after save: NOT SAVED!
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **–†–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ** - localStorage –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ cookies** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É—é—Ç localStorage
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ–º–µ–Ω–æ–º** - localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ (–Ω–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ)
# –û—Ç–∫–ª—é—á–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–º–µ–Ω –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ
```

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è

**–í –∫–æ–Ω—Å–æ–ª–∏:**
```
üíæ Saving token: eyJhbGciOiJIUzI1NiI...
‚úÖ Token saved to localStorage
# ... –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ...
üîë Getting token: eyJhbGciOiJIUzI1NiI...  ‚Üê OK
# –ù–û –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—à–∏–±–∫–∞ UNAUTHORIZED
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ Network –≤–∫–ª–∞–¥–∫–µ –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiI...
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ

**–í –∫–æ–Ω—Å–æ–ª–∏:**
```
üîê Attempting login for: admin authType: local
‚ùå Login error: Network Error
```

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend
sudo systemctl status utmn-security

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u utmn-security -n 50

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
sudo systemctl restart utmn-security
```

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

### –í—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å
localStorage.getItem('auth_token')

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å refresh —Ç–æ–∫–µ–Ω
localStorage.getItem('refresh_token')

// –û—á–∏—Å—Ç–∏—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
localStorage.removeItem('auth_token')
localStorage.removeItem('refresh_token')

// –ò–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
localStorage.clear()
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–∫–µ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫
fetch('/v1/users', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('auth_token')}`,
    'Content-Type': 'application/json'
  }
})
.then(r => r.json())
.then(console.log)
.catch(console.error)
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ –∫–æ–Ω—Å–æ–ª–∏** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network –≤–∫–ª–∞–¥–∫—É** - –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Application ‚Üí Local Storage** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–∏ —Ç–æ–∫–µ–Ω—ã
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend –ª–æ–≥–∏**: `sudo journalctl -u utmn-security -f`

---

**–î–∞—Ç–∞:** 26.01.2026  
**–í–µ—Ä—Å–∏—è:** 1.0.0
